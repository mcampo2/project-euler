<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadratic Primes</title>
    <style>
        body {
            width: 30rem;
        }

        #range {
            width: 2rem;
        }
    </style>
</head>
<body>
    <h1>Quadratic Primes</h1>
    <div>
        <h2>Problem</h2>
        <p>Euler discovered the remarkable quadratic formula:</p>
        <p><i>n</i><sup>2</sup> + <i>n</i> + 41</p>
        <p>It turns out that the formula will produce 40 primes for the
           consecutive integer values 0 ≤ <i>n</i> ≤ 39.  However, when <i>n</i>
           = 40, 40<sup>2</sup> + 40 + 41 = 40(40 + 1) + 41 is divisible by 41,
           and certainly when <i>n</i> = 41, 41<sup>2</sup> + 41 + 41 is clearly
           divisible by 41.</p>
        <p>The incredible formula <i>n</i><sup>2</sup> - 79<i>n</i> + 1601 was
           discovered, which produces 80 primes for the consecutive values 0 ≤
           <i>n</i> ≤ 79.  The product of the coefficients, -79 and 1601, is
           -126579.</p>
        <p>Considering quadratics of the form:</p>
        <p><i>n</i><sup>2</sup> + <i>an</i> + <i>b</i>, where |<i>a</i>| &lt;
           1000</p>
        <p>where |<i>n</i>| is the modulus/absolute value of <i>n</i></p>
        <p>e.g. |11| = 11 and |-4| = 4</p>
        <p>Find the product of the coefficients, <i>a</i> and <i>b</i>, for the
           quadratic expression that produces the maximum number of primes for
           consecutive values of <i>n</i>, starting with <i>n</i> = 0.</p>
    </div>
    <div>
        <h2>Solution</h2>
        <p>The product of the coefficients for the quadratic expression that
           produces the maximum number of primes for consecutive values, where
           the first coefficient is under
           <input id="range" type="text" value="1000"> is
           <b><span id="solution">???</span></b>.</p>
        <button id="solve">Solve</button>
    </div>
    <script>
        function solve() {
            answer = 0;
            range = document.getElementById("range").value;

            answer = solve2();
            
            document.getElementById("solution").textContent = answer;
        }

        function find_n_prime(a, b) {
            n = 1;
            while (is_prime(Math.abs( n ** 2 + a * n + b))) {
                n += 1;
            } return n;
        }
        
        function is_prime(number) {
            for(var i=2; i<=(number**0.5); i++) {
                if(number%i == 0) return false;
            } return true;
        }

        function solve2() {
            best = [1, 1];
            range_limit = 1000;
            maxsize = 2 ** Math.ceil(Math.log(2 * range_limit) / Math.log(2));
            is_prime_this = memoize(is_prime, maxsize);
            primes = Primes(range_limit);
            max_n_prime = 0;
            length = product(primes, 2).length;
            count = 0;
            product(primes, 2).forEach(x => {
                console.log("" + count++ + " / " + length);
                b = x[0];
                p = x[1];
                a = p - b - 1;
                new_n_prime = find_n_prime(a, b);
                if (new_n_prime > max_n_prime) {
                    max_n_prime = new_n_prime;
                    best = [a, b];
                }
            })

            answer = best[0] * best[1];
            console.log("ANSWER: [" + best[0] + ", " + best[1] + "]");
            return answer;
        } /* expected_answer = -59231 */

        function memoize(func, maxsize) {
            cache = {};
            function wrapper(args) {
                if (args in cache) {
                    return cache[args];
                } result = func(args);
                if (Object.keys(cache).length >= maxsize) {
                    cache = {};
                } cache[args] = result;
                return result;
            } return wrapper;
        }

        function Primes(upper_bound) {
            temp = (Math.floor(upper_bound / 3) + 1)
            sieve = [temp, temp, 0];
            for (i = 5; i <= Math.sqrt(upper_bound); i += 2) {
                if (sieve[i / 3]) {
                    continue;
                } for (j = i ** 2; j < upper_bound; j += 2 * i) {
                    sieve[j / 3] = true;
                }
            }
            primes = [2, 3]
            for(i = 1; i < upper_bound / 3; i++) {
                if (!sieve[i]) {
                    primes.push(3 * i + 1);
                }
            }
            return primes;
        }

        function product(str, length) {
            function helper(prefix, chars, depth) {
                if (depth === 0) {
                    return [prefix];
                }
                let result = [];
                for (let char of chars) {
                    result = result.concat(helper([...prefix, char], chars, depth - 1));
                }
                return result;
            }

            return helper([], str, length);
        }

        document.getElementById("range").addEventListener("keydown",
            function(event) {
                if (event.key === "Enter") {
                    document.getElementById("solve").focus();
                    solve();
                }
            }
        );
        
        document.getElementById("solve").onclick = solve;
    </script>
</body>
</html>